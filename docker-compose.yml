version: "3.9"

services:
  redis:
    image: redis:latest
    container_name: my-redis
    ports:
      - "6379:6379"

  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.13.4
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
    ports:
      - "9200:9200"
      - "9300:9300"

  nodejs:
    build:
      context: ./api-service
      dockerfile: Dockerfile
    container_name: api-service
    ports:
      - "9080:9080"
    environment:
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - ELASTICSEARCH_HOST=elasticsearch
      - ELASTICSEARCH_PORT=9200
      - KAFKA_HOST=kafka
      - KAFKA_PORT=9092
    depends_on:
      - redis
      - elasticsearch
      # - kafka
      # - zookeeper
  
  simulator:
    build:
      context: ./simulator
      dockerfile: Dockerfile
    container_name: simulator
    env_file:
      - simulator/.env
    
  elastic-ingestor:
    build:
      context: ./elastic-ingestor
      dockerfile: Dockerfile
    container_name: elastic-ingestor
    env_file:
      - elastic-ingestor/.env
    depends_on:
      - elasticsearch